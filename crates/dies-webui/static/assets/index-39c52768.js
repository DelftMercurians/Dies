var mt=Object.defineProperty;var _t=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var L=(e,t,n)=>(_t(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();function k(){}function wt(e,t){for(const n in t)e[n]=t[n];return e}function be(e){return e()}function _e(){return Object.create(null)}function Y(e){e.forEach(be)}function v(e){return typeof e=="function"}function ne(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function vt(e){return Object.keys(e).length===0}function bt(e,...t){if(e==null)return k;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Lt(e,t,n){e.$$.on_destroy.push(bt(t,n))}function Et(e,t,n,i){if(e){const s=Le(e,t,n,i);return e[0](s)}}function Le(e,t,n,i){return e[1]&&i?wt(n.ctx.slice(),e[1](i(t))):n.ctx}function St(e,t,n,i){if(e[2]&&i){const s=e[2](i(n));if(t.dirty===void 0)return s;if(typeof s=="object"){const l=[],d=Math.max(t.dirty.length,s.length);for(let h=0;h<d;h+=1)l[h]=t.dirty[h]|s[h];return l}return t.dirty|s}return t.dirty}function Rt(e,t,n,i,s,l){if(s){const d=Le(t,n,i,l);e.p(d,s)}}function kt(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let i=0;i<n;i++)t[i]=-1;return t}return-1}function T(e,t){e.appendChild(t)}function j(e,t,n){e.insertBefore(t,n||null)}function W(e){e.parentNode&&e.parentNode.removeChild(e)}function P(e){return document.createElement(e)}function It(e){return document.createTextNode(e)}function x(){return It(" ")}function a(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function Z(e){return function(t){return t.preventDefault(),e.call(this,t)}}function R(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ct(e){return Array.from(e.childNodes)}function A(e,t,n,i){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function Pt(e,t,{bubbles:n=!1,cancelable:i=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,i,t),s}let X;function U(e){X=e}function H(){if(!X)throw new Error("Function called outside component initialization");return X}function de(e){H().$$.on_mount.push(e)}function he(e){H().$$.on_destroy.push(e)}function Ot(){const e=H();return(t,n,{cancelable:i=!1}={})=>{const s=e.$$.callbacks[t];if(s){const l=Pt(t,n,{cancelable:i});return s.slice().forEach(d=>{d.call(e,l)}),!l.defaultPrevented}return!0}}function Tt(e,t){return H().$$.context.set(e,t),t}function At(e){return H().$$.context.get(e)}function f(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const q=[],te=[],$=[],we=[],Dt=Promise.resolve();let ue=!1;function Mt(){ue||(ue=!0,Dt.then(Ee))}function ce(e){$.push(e)}const ae=new Set;let D=0;function Ee(){if(D!==0)return;const e=X;do{try{for(;D<q.length;){const t=q[D];D++,U(t),qt(t.$$)}}catch(t){throw q.length=0,D=0,t}for(U(null),q.length=0,D=0;te.length;)te.pop()();for(let t=0;t<$.length;t+=1){const n=$[t];ae.has(n)||(ae.add(n),n())}$.length=0}while(q.length);for(;we.length;)we.pop()();ue=!1,ae.clear(),U(e)}function qt(e){if(e.fragment!==null){e.update(),Y(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ce)}}const ee=new Set;let Wt;function re(e,t){e&&e.i&&(ee.delete(e),e.i(t))}function fe(e,t,n,i){if(e&&e.o){if(ee.has(e))return;ee.add(e),Wt.c.push(()=>{ee.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function Se(e){e&&e.c()}function pe(e,t,n,i){const{fragment:s,after_update:l}=e.$$;s&&s.m(t,n),i||ce(()=>{const d=e.$$.on_mount.map(be).filter(v);e.$$.on_destroy?e.$$.on_destroy.push(...d):Y(d),e.$$.on_mount=[]}),l.forEach(ce)}function ye(e,t){const n=e.$$;n.fragment!==null&&(Y(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Nt(e,t){e.$$.dirty[0]===-1&&(q.push(e),Mt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ge(e,t,n,i,s,l,d,h=[-1]){const u=X;U(e);const c=e.$$={fragment:null,ctx:[],props:l,update:k,not_equal:s,bound:_e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:_e(),dirty:h,skip_bound:!1,root:t.target||u.$$.root};d&&d(c.root);let y=!1;if(c.ctx=n?n(e,t.props||{},(o,_,...g)=>{const w=g.length?g[0]:_;return c.ctx&&s(c.ctx[o],c.ctx[o]=w)&&(!c.skip_bound&&c.bound[o]&&c.bound[o](w),y&&Nt(e,o)),_}):[],c.update(),y=!0,Y(c.before_update),c.fragment=i?i(c.ctx):!1,t.target){if(t.hydrate){const o=Ct(t.target);c.fragment&&c.fragment.l(o),o.forEach(W)}else c.fragment&&c.fragment.c();t.intro&&re(e.$$.fragment),pe(e,t.target,t.anchor,t.customElement),Ee()}U(u)}class me{$destroy(){ye(this,1),this.$destroy=k}$on(t,n){if(!v(n))return k;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(t){this.$$set&&!vt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}class zt{constructor(){L(this,"currentLayerId");L(this,"setups");L(this,"renderers");L(this,"dispatchers");L(this,"needsSetup");L(this,"needsRedraw");L(this,"context");L(this,"width");L(this,"height");L(this,"autoclear");L(this,"pixelRatio");L(this,"renderLoop");L(this,"layerObserver");L(this,"layerRef");L(this,"layerSequence");L(this,"renderingLayerId");L(this,"activeLayerId");L(this,"activeLayerDispatcher");this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.getRenderingLayerId=this.getRenderingLayerId.bind(this),this.currentLayerId=1,this.setups=new Map,this.renderers=new Map,this.dispatchers=new Map,this.needsSetup=!1,this.needsRedraw=!0,this.renderingLayerId=0,this.activeLayerId=0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}register({setup:t,render:n,dispatcher:i}){return t&&(this.setups.set(this.currentLayerId,t),this.needsSetup=!0),this.renderers.set(this.currentLayerId,n),this.dispatchers.set(this.currentLayerId,i),this.needsRedraw=!0,this.currentLayerId++}unregister(t){this.renderers.delete(t),this.dispatchers.delete(t),this.needsRedraw=!0}setup(t,n){this.context=t,this.layerRef=n,this.observeLayerSequence(),this.startRenderLoop()}observeLayerSequence(){this.layerObserver=new MutationObserver(this.getLayerSequence.bind(this)),this.layerObserver.observe(this.layerRef,{childList:!0}),this.getLayerSequence()}getLayerSequence(){const t=[...this.layerRef.children];this.layerSequence=t.map(n=>+(n.dataset.layerId??-1)),this.redraw()}startRenderLoop(){this.render(),this.renderLoop=requestAnimationFrame(()=>this.startRenderLoop())}render(){const t=this.context,n=this.width,i=this.height,s=this.pixelRatio;if(this.needsSetup){for(const[l,d]of this.setups)d({context:t,width:n,height:i}),this.setups.delete(l);this.needsSetup=!1}if(this.needsRedraw){t.setTransform(s,0,0,s,0,0),this.autoclear&&t.clearRect(0,0,n,i);for(const l of this.layerSequence)this.renderingLayerId=l,this.renderers.get(l)?.({context:t,width:n,height:i});this.needsRedraw=!1}}setActiveLayer(t,n){this.activeLayerId!==t&&(n instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerleave",n)),this.dispatchLayerEvent(new MouseEvent("mouseleave",n))),this.activeLayerId=t,this.activeLayerDispatcher=this.dispatchers.get(t),n instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerenter",n)),this.dispatchLayerEvent(new MouseEvent("mouseenter",n))))}dispatchLayerEvent(t){if(this.activeLayerDispatcher){if(window.TouchEvent&&t instanceof TouchEvent){const{left:n,top:i}=t.target.getBoundingClientRect(),{clientX:s,clientY:l}=t.changedTouches[0],d={x:s-n,y:l-i,originalEvent:t};this.activeLayerDispatcher(t.type,d)}else if(t instanceof MouseEvent){const n={x:t.offsetX,y:t.offsetY,originalEvent:t};this.activeLayerDispatcher(t.type,n)}}}getRenderingLayerId(){return this.renderingLayerId}destroy(){typeof window>"u"||(this.layerObserver.disconnect(),cancelAnimationFrame(this.renderLoop))}}const Bt=e=>{const t=e*2,n=t>>16&255,i=t>>8&255,s=t&255;return`rgb(${n}, ${i}, ${s})`},Ft=(e,t,n)=>{const i=(e<<16|t<<8|n)/2;return i%1?0:i},jt=["drawImage"],Ut=["filter","shadowBlur","globalCompositeOperation","globalAlpha"],Xt=["drawImage","fill","fillRect","fillText","stroke","strokeRect","strokeText"],Yt=e=>{let t;const n=document.createElement("canvas"),i=n.getContext("2d",{willReadFrequently:!0}),s=()=>{n.width=e.canvas.width,n.height=e.canvas.height};return new MutationObserver(s).observe(e.canvas,{attributeFilter:["width","height"]}),s(),new Proxy(e,{get(d,h){if(h==="_getLayerIdAtPixel")return(c,y)=>{const[o,_,g]=i.getImageData(c,y,1,1).data;return Ft(o,_,g)};const u=d[h];return typeof u!="function"?u:function(...c){if(Xt.includes(h)){const y=Bt(t());i.fillStyle=y,i.strokeStyle=y}if(h==="drawImage"){const y=c.slice(1);i.fillRect(...y)}return jt.includes(h)||Reflect.apply(u,i,c),Reflect.apply(u,d,c)}},set(d,h,u){return h==="_renderingLayerId"?(t=u,!0):(d[h]=u,Ut.includes(h)||(i[h]=u),!0)}})};function Ht(e){let t,n,i,s=`${e[0]}px`,l=`${e[1]}px`,d,h,u,c,y;const o=e[18].default,_=Et(o,e,e[17],null);return{c(){t=P("canvas"),d=x(),h=P("div"),_&&_.c(),R(t,"width",n=e[0]*e[5]),R(t,"height",i=e[1]*e[5]),R(t,"class",e[4]),R(t,"style",e[2]),A(t,"display","block"),A(t,"width",s),A(t,"height",l),A(h,"display","none")},m(g,w){j(g,t,w),e[64](t),j(g,d,w),j(g,h,w),_&&_.m(h,null),e[65](h),u=!0,c||(y=[a(t,"touchstart",Z(function(){v(e[3]?e[9]:null)&&(e[3]?e[9]:null).apply(this,arguments)})),a(t,"mousemove",function(){v(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),a(t,"pointermove",function(){v(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),a(t,"click",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"contextmenu",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"dblclick",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"mousedown",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"mouseenter",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"mouseleave",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"mouseup",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"wheel",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"touchcancel",Z(function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),a(t,"touchend",Z(function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),a(t,"touchmove",Z(function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),a(t,"pointerenter",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"pointerleave",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"pointerdown",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"pointerup",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"pointercancel",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),a(t,"focus",e[19]),a(t,"blur",e[20]),a(t,"fullscreenchange",e[21]),a(t,"fullscreenerror",e[22]),a(t,"scroll",e[23]),a(t,"cut",e[24]),a(t,"copy",e[25]),a(t,"paste",e[26]),a(t,"keydown",e[27]),a(t,"keypress",e[28]),a(t,"keyup",e[29]),a(t,"auxclick",e[30]),a(t,"click",e[31]),a(t,"contextmenu",e[32]),a(t,"dblclick",e[33]),a(t,"mousedown",e[34]),a(t,"mouseenter",e[35]),a(t,"mouseleave",e[36]),a(t,"mousemove",e[37]),a(t,"mouseover",e[38]),a(t,"mouseout",e[39]),a(t,"mouseup",e[40]),a(t,"select",e[41]),a(t,"wheel",e[42]),a(t,"drag",e[43]),a(t,"dragend",e[44]),a(t,"dragenter",e[45]),a(t,"dragstart",e[46]),a(t,"dragleave",e[47]),a(t,"dragover",e[48]),a(t,"drop",e[49]),a(t,"touchcancel",e[50]),a(t,"touchend",e[51]),a(t,"touchmove",e[52]),a(t,"touchstart",e[53]),a(t,"pointerover",e[54]),a(t,"pointerenter",e[55]),a(t,"pointerdown",e[56]),a(t,"pointermove",e[57]),a(t,"pointerup",e[58]),a(t,"pointercancel",e[59]),a(t,"pointerout",e[60]),a(t,"pointerleave",e[61]),a(t,"gotpointercapture",e[62]),a(t,"lostpointercapture",e[63])],c=!0)},p(g,w){e=g,(!u||w[0]&33&&n!==(n=e[0]*e[5]))&&R(t,"width",n),(!u||w[0]&34&&i!==(i=e[1]*e[5]))&&R(t,"height",i),(!u||w[0]&16)&&R(t,"class",e[4]),(!u||w[0]&4)&&R(t,"style",e[2]),w[0]&1&&s!==(s=`${e[0]}px`)&&A(t,"width",s),w[0]&2&&l!==(l=`${e[1]}px`)&&A(t,"height",l),_&&_.p&&(!u||w[0]&131072)&&Rt(_,o,e,e[17],u?St(o,e[17],w,null):kt(e[17]),null)},i(g){u||(re(_,g),u=!0)},o(g){fe(_,g),u=!1},d(g){g&&W(t),e[64](null),g&&W(d),g&&W(h),_&&_.d(g),e[65](null),c=!1,Y(y)}}}const Re=Symbol(),Kt=()=>At(Re);function Gt(e,t,n){let i,{$$slots:s={},$$scope:l}=t,{width:d=640,height:h=640,pixelRatio:u=null,style:c="",autoclear:y=!0,layerEvents:o=!1}=t,{class:_=""}=t,g,w=null,E;const p=new zt;function N(){p.redraw()}function K(){return g}function G(){return w}u==null&&(typeof window<"u"?u=window.devicePixelRatio:u=2),Tt(Re,{register:p.register,unregister:p.unregister,redraw:p.redraw}),de(()=>{const r=g.getContext("2d");o?(w=Yt(r),w._renderingLayerId=p.getRenderingLayerId):w=r,p.setup(w,E)}),he(()=>p.destroy());const z=r=>{const se=r.offsetX*i,oe=r.offsetY*i,le=w._getLayerIdAtPixel(se,oe);p.setActiveLayer(le,r),p.dispatchLayerEvent(r)},J=r=>{const{clientX:se,clientY:oe}=r.changedTouches[0],{left:le,top:ft}=g.getBoundingClientRect(),pt=(se-le)*i,yt=(oe-ft)*i,gt=w._getLayerIdAtPixel(pt,yt);p.setActiveLayer(gt,r),p.dispatchLayerEvent(r)},O=r=>{window.TouchEvent&&r instanceof TouchEvent&&r.preventDefault(),p.dispatchLayerEvent(r)};function Q(r){f.call(this,e,r)}function m(r){f.call(this,e,r)}function b(r){f.call(this,e,r)}function S(r){f.call(this,e,r)}function B(r){f.call(this,e,r)}function I(r){f.call(this,e,r)}function C(r){f.call(this,e,r)}function F(r){f.call(this,e,r)}function ie(r){f.call(this,e,r)}function Pe(r){f.call(this,e,r)}function Oe(r){f.call(this,e,r)}function Te(r){f.call(this,e,r)}function Ae(r){f.call(this,e,r)}function De(r){f.call(this,e,r)}function Me(r){f.call(this,e,r)}function qe(r){f.call(this,e,r)}function We(r){f.call(this,e,r)}function Ne(r){f.call(this,e,r)}function ze(r){f.call(this,e,r)}function Be(r){f.call(this,e,r)}function Fe(r){f.call(this,e,r)}function je(r){f.call(this,e,r)}function Ue(r){f.call(this,e,r)}function Xe(r){f.call(this,e,r)}function Ye(r){f.call(this,e,r)}function He(r){f.call(this,e,r)}function Ke(r){f.call(this,e,r)}function Ge(r){f.call(this,e,r)}function Je(r){f.call(this,e,r)}function Qe(r){f.call(this,e,r)}function Ze(r){f.call(this,e,r)}function Ve(r){f.call(this,e,r)}function xe(r){f.call(this,e,r)}function $e(r){f.call(this,e,r)}function et(r){f.call(this,e,r)}function tt(r){f.call(this,e,r)}function nt(r){f.call(this,e,r)}function rt(r){f.call(this,e,r)}function it(r){f.call(this,e,r)}function st(r){f.call(this,e,r)}function ot(r){f.call(this,e,r)}function lt(r){f.call(this,e,r)}function at(r){f.call(this,e,r)}function ut(r){f.call(this,e,r)}function ct(r){f.call(this,e,r)}function dt(r){te[r?"unshift":"push"](()=>{g=r,n(6,g)})}function ht(r){te[r?"unshift":"push"](()=>{E=r,n(7,E)})}return e.$$set=r=>{"width"in r&&n(0,d=r.width),"height"in r&&n(1,h=r.height),"pixelRatio"in r&&n(11,u=r.pixelRatio),"style"in r&&n(2,c=r.style),"autoclear"in r&&n(12,y=r.autoclear),"layerEvents"in r&&n(3,o=r.layerEvents),"class"in r&&n(4,_=r.class),"$$scope"in r&&n(17,l=r.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&2048&&n(5,i=u??1),e.$$.dirty[0]&1&&n(16,p.width=d,p),e.$$.dirty[0]&2&&n(16,p.height=h,p),e.$$.dirty[0]&32&&n(16,p.pixelRatio=i,p),e.$$.dirty[0]&4096&&n(16,p.autoclear=y,p),e.$$.dirty[0]&71683&&p.redraw()},[d,h,c,o,_,i,g,E,z,J,O,u,y,N,K,G,p,l,s,Q,m,b,S,B,I,C,F,ie,Pe,Oe,Te,Ae,De,Me,qe,We,Ne,ze,Be,Fe,je,Ue,Xe,Ye,He,Ke,Ge,Je,Qe,Ze,Ve,xe,$e,et,tt,nt,rt,it,st,ot,lt,at,ut,ct,dt,ht]}class Jt extends me{constructor(t){super(),ge(this,t,Gt,Ht,ne,{width:0,height:1,pixelRatio:11,style:2,autoclear:12,layerEvents:3,class:4,redraw:13,getCanvas:14,getContext:15},null,[-1,-1,-1])}get redraw(){return this.$$.ctx[13]}get getCanvas(){return this.$$.ctx[14]}get getContext(){return this.$$.ctx[15]}}function Qt(e){let t;return{c(){t=P("div"),R(t,"data-layer-id",e[0])},m(n,i){j(n,t,i)},p:k,i:k,o:k,d(n){n&&W(t)}}}function Zt(e,t,n){const{register:i,unregister:s,redraw:l}=Kt(),d=Ot();let{setup:h=void 0}=t,{render:u=()=>{}}=t;const c=i({setup:h,render:u,dispatcher:d});return he(()=>s(c)),e.$$set=y=>{"setup"in y&&n(1,h=y.setup),"render"in y&&n(2,u=y.render)},e.$$.update=()=>{e.$$.dirty&4&&l()},[c,h,u]}class Vt extends me{constructor(t){super(),ge(this,t,Zt,Qt,ne,{setup:1,render:2})}}const M=[];function xt(e,t){return{subscribe:ke(e,t).subscribe}}function ke(e,t=k){let n;const i=new Set;function s(h){if(ne(e,h)&&(e=h,n)){const u=!M.length;for(const c of i)c[1](),M.push(c,e);if(u){for(let c=0;c<M.length;c+=2)M[c][0](M[c+1]);M.length=0}}}function l(h){s(h(e))}function d(h,u=k){const c=[h,u];return i.add(c),i.size===1&&(n=t(s)||k),h(e),()=>{i.delete(c),i.size===0&&(n(),n=null)}}return{set:s,update:l,subscribe:d}}let ve;const Ie=Date.now(),Ce=e=>(e(Date.now()-Ie),ve=window.requestAnimationFrame(()=>Ce(e)),()=>window.cancelAnimationFrame(ve));function $t(){}xt(Date.now()-Ie,typeof window>"u"?$t:Ce);function en(){const e=ke(null);let t,n=[];function i(){console.log("Connecting to WebSocket..."),t=new WebSocket("ws://localhost:5555/api/ws"),t.onerror=l=>{console.error("WebSocket error:",l),t.readyState===WebSocket.CLOSED&&(console.log("WebSocket connection closed. Reconnecting..."),setTimeout(i,1e3))},t.onopen=()=>{console.log("WebSocket connection established."),n.forEach(l=>{s(l)}),n=[]},t.onmessage=l=>{const d=JSON.parse(l.data);e.set(d)},t.onclose=()=>{console.log("WebSocket connection closed. Reconnecting..."),setTimeout(i,1e3)},t.onerror=l=>{console.error("WebSocket error:",l)}}function s(l){t.readyState===WebSocket.OPEN?t.send(JSON.stringify(l)):t.readyState===WebSocket.CLOSED&&(console.log("WebSocket connection closed. Reconnecting..."),n.length===0&&i(),n.push(l))}return de(()=>{i(),fetch("/api/state").then(l=>l.json()).then(l=>{e.set(l)})}),he(()=>{t&&t.close()}),{worldState:e,sendCommand:s}}function tn(e){let t,n;return t=new Vt({props:{render:e[0]}}),{c(){Se(t.$$.fragment)},m(i,s){pe(t,i,s),n=!0},p(i,s){const l={};s&1&&(l.render=i[0]),t.$set(l)},i(i){n||(re(t.$$.fragment,i),n=!0)},o(i){fe(t.$$.fragment,i),n=!1},d(i){ye(t,i)}}}function nn(e){let t,n,i,s,l,d,h,u,c;return d=new Jt({props:{width:840,height:600,class:"canvas",$$slots:{default:[tn]},$$scope:{ctx:e}}}),{c(){t=P("main"),n=P("div"),n.innerHTML='<canvas id="velocityChart" width="400" height="400"></canvas>',i=x(),s=P("div"),s.innerHTML='<canvas id="velocityChart" width="400" height="400"></canvas>',l=x(),Se(d.$$.fragment),h=x(),u=P("div"),R(n,"class","sidebar svelte-pe4n82"),R(s,"class","sidebar svelte-pe4n82"),R(u,"class","sidebar svelte-pe4n82"),R(t,"class","cont svelte-pe4n82")},m(y,o){j(y,t,o),T(t,n),T(t,i),T(t,s),T(t,l),pe(d,t,null),T(t,h),T(t,u),c=!0},p(y,[o]){const _={};o&257&&(_.$$scope={dirty:o,ctx:y}),d.$set(_)},i(y){c||(re(d.$$.fragment,y),c=!0)},o(y){fe(d.$$.fragment,y),c=!1},d(y){y&&W(t),ye(d)}}}const V=20;function rn(e,t,n){let i;const{sendCommand:d,worldState:h}=en();Lt(e,h,o=>n(4,i=o));let u=null;de(()=>{let o=new Set;const _=E=>{o.add(E.key)},g=E=>{o.delete(E.key)};let w=setInterval(()=>{if(o.size===0)return;const E=i?.own_players.find(N=>N.id===u);if(!E){console.error("Player not found");return}const p={id:E.id,sx:0,sy:0,w:0,dribble_speed:0,arm:!1,disarm:!1,kick:!1};o.has("w")&&(p.sx=1),o.has("s")&&(p.sx=-1),o.has("a")&&(p.sy=1),o.has("d")&&(p.sy=-1),o.has("q")&&(p.w=1),o.has("e")&&(p.w=-1),o.has(" ")&&(p.dribble_speed=200),(p.sx!==0||p.sy!==0||p.w!==0)&&d({type:"directPlayerCmd",cmd:p})},1/10);return window.addEventListener("keydown",_),window.addEventListener("keyup",g),()=>{clearInterval(w),window.removeEventListener("keydown",_),window.removeEventListener("keyup",g)}});let c=null,y;return e.$$.update=()=>{e.$$.dirty&28&&n(0,y=({context:o,width:_,height:g})=>{if(!i)return;const w=_-V*2,E=g-V*2,{own_players:p,opp_players:N,ball:K}=i,G=i.field_geom?.field_width??0,z=i.field_geom?.field_length??0,J=m=>Math.ceil(m*(w/z)),O=m=>{const[b,S]=m;return[(b+z/2)*(w/z)+V,(-S+G/2)*(E/G)+V]};o.fillStyle="#00aa00",o.clearRect(0,0,_,g),o.fillRect(0,0,_,g),i.field_geom?.line_segments?.forEach?.(({p1:m,p2:b})=>{const[S,B]=O(m),[I,C]=O(b);o.strokeStyle="white",o.beginPath(),o.moveTo(S,B),o.lineTo(I,C),o.stroke()});const Q=(m,b,S,B)=>{const[I,C]=O(m),F=J(140);o.fillStyle=S,o.beginPath(),o.arc(I,C,F,0,2*Math.PI),o.fill();const ie=-b;o.save(),o.translate(I,C),o.rotate(ie),o.beginPath(),o.moveTo(0,0),o.lineTo(F,0),o.closePath(),o.restore(),o.stroke(),B&&(o.strokeStyle="white",o.lineWidth=2,o.beginPath(),o.arc(I,C,F+2,0,2*Math.PI),o.stroke())};if(p.forEach(({id:m,raw_position:b,orientation:S})=>Q(b,S,"blue",m===u)),N.forEach(({raw_position:m,orientation:b})=>Q(m,b,"yellow",!1)),K){const m=O(K.position),b=J(43);o.fillStyle="red",o.beginPath(),o.arc(m[0],m[1],b,0,2*Math.PI),o.fill()}if(i?.own_players.length>0){let m=i.own_players[0];if(u===null)n(2,u=i.own_players[0].id);else{const b=i.own_players.find(S=>S.id===u);b?m=b:n(2,u=m.id)}Math.sqrt(m.velocity[0]**2+m.velocity[1]**2),c===null&&n(3,c=m.timestamp),m.timestamp-c}if(i?.own_players.length>0){let m=i.own_players[0];if(u===null)n(2,u=i.own_players[0].id);else{const b=i.own_players.find(S=>S.id===u);b?m=b:n(2,u=m.id)}Math.sqrt(m.velocity[0]**2+m.velocity[1]**2),c===null&&n(3,c=m.timestamp),m.timestamp-c}})},[y,h,u,c,i]}class sn extends me{constructor(t){super(),ge(this,t,rn,nn,ne,{})}}new sn({target:document.getElementById("app")});
