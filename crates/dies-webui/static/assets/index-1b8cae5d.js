var mt=Object.defineProperty;var _t=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var L=(e,t,n)=>(_t(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function I(){}function wt(e,t){for(const n in t)e[n]=t[n];return e}function ve(e){return e()}function me(){return Object.create(null)}function X(e){e.forEach(ve)}function v(e){return typeof e=="function"}function te(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function vt(e){return Object.keys(e).length===0}function bt(e,...t){if(e==null)return I;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Lt(e,t,n){e.$$.on_destroy.push(bt(t,n))}function Et(e,t,n,i){if(e){const s=be(e,t,n,i);return e[0](s)}}function be(e,t,n,i){return e[1]&&i?wt(n.ctx.slice(),e[1](i(t))):n.ctx}function St(e,t,n,i){if(e[2]&&i){const s=e[2](i(n));if(t.dirty===void 0)return s;if(typeof s=="object"){const o=[],d=Math.max(t.dirty.length,s.length);for(let h=0;h<d;h+=1)o[h]=t.dirty[h]|s[h];return o}return t.dirty|s}return t.dirty}function Rt(e,t,n,i,s,o){if(s){const d=be(t,n,i,o);e.p(d,s)}}function It(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let i=0;i<n;i++)t[i]=-1;return t}return-1}function A(e,t){e.appendChild(t)}function F(e,t,n){e.insertBefore(t,n||null)}function W(e){e.parentNode&&e.parentNode.removeChild(e)}function k(e){return document.createElement(e)}function kt(e){return document.createTextNode(e)}function V(){return kt(" ")}function l(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function Q(e){return function(t){return t.preventDefault(),e.call(this,t)}}function S(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ct(e){return Array.from(e.childNodes)}function D(e,t,n,i){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function Pt(e,t,{bubbles:n=!1,cancelable:i=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,i,t),s}let U;function j(e){U=e}function Y(){if(!U)throw new Error("Function called outside component initialization");return U}function ce(e){Y().$$.on_mount.push(e)}function de(e){Y().$$.on_destroy.push(e)}function Ot(){const e=Y();return(t,n,{cancelable:i=!1}={})=>{const s=e.$$.callbacks[t];if(s){const o=Pt(t,n,{cancelable:i});return s.slice().forEach(d=>{d.call(e,o)}),!o.defaultPrevented}return!0}}function Tt(e,t){return Y().$$.context.set(e,t),t}function At(e){return Y().$$.context.get(e)}function f(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const N=[],ee=[],x=[],_e=[],Dt=Promise.resolve();let ae=!1;function Mt(){ae||(ae=!0,Dt.then(Le))}function ue(e){x.push(e)}const le=new Set;let M=0;function Le(){if(M!==0)return;const e=U;do{try{for(;M<N.length;){const t=N[M];M++,j(t),qt(t.$$)}}catch(t){throw N.length=0,M=0,t}for(j(null),N.length=0,M=0;ee.length;)ee.pop()();for(let t=0;t<x.length;t+=1){const n=x[t];le.has(n)||(le.add(n),n())}x.length=0}while(N.length);for(;_e.length;)_e.pop()();ae=!1,le.clear(),j(e)}function qt(e){if(e.fragment!==null){e.update(),X(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ue)}}const $=new Set;let Nt;function ne(e,t){e&&e.i&&($.delete(e),e.i(t))}function he(e,t,n,i){if(e&&e.o){if($.has(e))return;$.add(e),Nt.c.push(()=>{$.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function Ee(e){e&&e.c()}function fe(e,t,n,i){const{fragment:s,after_update:o}=e.$$;s&&s.m(t,n),i||ue(()=>{const d=e.$$.on_mount.map(ve).filter(v);e.$$.on_destroy?e.$$.on_destroy.push(...d):X(d),e.$$.on_mount=[]}),o.forEach(ue)}function pe(e,t){const n=e.$$;n.fragment!==null&&(X(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Wt(e,t){e.$$.dirty[0]===-1&&(N.push(e),Mt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ye(e,t,n,i,s,o,d,h=[-1]){const c=U;j(e);const u=e.$$={fragment:null,ctx:[],props:o,update:I,not_equal:s,bound:me(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:me(),dirty:h,skip_bound:!1,root:t.target||c.$$.root};d&&d(u.root);let y=!1;if(u.ctx=n?n(e,t.props||{},(a,_,...g)=>{const w=g.length?g[0]:_;return u.ctx&&s(u.ctx[a],u.ctx[a]=w)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](w),y&&Wt(e,a)),_}):[],u.update(),y=!0,X(u.before_update),u.fragment=i?i(u.ctx):!1,t.target){if(t.hydrate){const a=Ct(t.target);u.fragment&&u.fragment.l(a),a.forEach(W)}else u.fragment&&u.fragment.c();t.intro&&ne(e.$$.fragment),fe(e,t.target,t.anchor,t.customElement),Le()}j(c)}class ge{$destroy(){pe(this,1),this.$destroy=I}$on(t,n){if(!v(n))return I;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(t){this.$$set&&!vt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}class zt{constructor(){L(this,"currentLayerId");L(this,"setups");L(this,"renderers");L(this,"dispatchers");L(this,"needsSetup");L(this,"needsRedraw");L(this,"context");L(this,"width");L(this,"height");L(this,"autoclear");L(this,"pixelRatio");L(this,"renderLoop");L(this,"layerObserver");L(this,"layerRef");L(this,"layerSequence");L(this,"renderingLayerId");L(this,"activeLayerId");L(this,"activeLayerDispatcher");this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.getRenderingLayerId=this.getRenderingLayerId.bind(this),this.currentLayerId=1,this.setups=new Map,this.renderers=new Map,this.dispatchers=new Map,this.needsSetup=!1,this.needsRedraw=!0,this.renderingLayerId=0,this.activeLayerId=0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}register({setup:t,render:n,dispatcher:i}){return t&&(this.setups.set(this.currentLayerId,t),this.needsSetup=!0),this.renderers.set(this.currentLayerId,n),this.dispatchers.set(this.currentLayerId,i),this.needsRedraw=!0,this.currentLayerId++}unregister(t){this.renderers.delete(t),this.dispatchers.delete(t),this.needsRedraw=!0}setup(t,n){this.context=t,this.layerRef=n,this.observeLayerSequence(),this.startRenderLoop()}observeLayerSequence(){this.layerObserver=new MutationObserver(this.getLayerSequence.bind(this)),this.layerObserver.observe(this.layerRef,{childList:!0}),this.getLayerSequence()}getLayerSequence(){const t=[...this.layerRef.children];this.layerSequence=t.map(n=>+(n.dataset.layerId??-1)),this.redraw()}startRenderLoop(){this.render(),this.renderLoop=requestAnimationFrame(()=>this.startRenderLoop())}render(){const t=this.context,n=this.width,i=this.height,s=this.pixelRatio;if(this.needsSetup){for(const[o,d]of this.setups)d({context:t,width:n,height:i}),this.setups.delete(o);this.needsSetup=!1}if(this.needsRedraw){t.setTransform(s,0,0,s,0,0),this.autoclear&&t.clearRect(0,0,n,i);for(const o of this.layerSequence)this.renderingLayerId=o,this.renderers.get(o)?.({context:t,width:n,height:i});this.needsRedraw=!1}}setActiveLayer(t,n){this.activeLayerId!==t&&(n instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerleave",n)),this.dispatchLayerEvent(new MouseEvent("mouseleave",n))),this.activeLayerId=t,this.activeLayerDispatcher=this.dispatchers.get(t),n instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerenter",n)),this.dispatchLayerEvent(new MouseEvent("mouseenter",n))))}dispatchLayerEvent(t){if(this.activeLayerDispatcher){if(window.TouchEvent&&t instanceof TouchEvent){const{left:n,top:i}=t.target.getBoundingClientRect(),{clientX:s,clientY:o}=t.changedTouches[0],d={x:s-n,y:o-i,originalEvent:t};this.activeLayerDispatcher(t.type,d)}else if(t instanceof MouseEvent){const n={x:t.offsetX,y:t.offsetY,originalEvent:t};this.activeLayerDispatcher(t.type,n)}}}getRenderingLayerId(){return this.renderingLayerId}destroy(){typeof window>"u"||(this.layerObserver.disconnect(),cancelAnimationFrame(this.renderLoop))}}const Bt=e=>{const t=e*2,n=t>>16&255,i=t>>8&255,s=t&255;return`rgb(${n}, ${i}, ${s})`},Ft=(e,t,n)=>{const i=(e<<16|t<<8|n)/2;return i%1?0:i},jt=["drawImage"],Ut=["filter","shadowBlur","globalCompositeOperation","globalAlpha"],Xt=["drawImage","fill","fillRect","fillText","stroke","strokeRect","strokeText"],Yt=e=>{let t;const n=document.createElement("canvas"),i=n.getContext("2d",{willReadFrequently:!0}),s=()=>{n.width=e.canvas.width,n.height=e.canvas.height};return new MutationObserver(s).observe(e.canvas,{attributeFilter:["width","height"]}),s(),new Proxy(e,{get(d,h){if(h==="_getLayerIdAtPixel")return(u,y)=>{const[a,_,g]=i.getImageData(u,y,1,1).data;return Ft(a,_,g)};const c=d[h];return typeof c!="function"?c:function(...u){if(Xt.includes(h)){const y=Bt(t());i.fillStyle=y,i.strokeStyle=y}if(h==="drawImage"){const y=u.slice(1);i.fillRect(...y)}return jt.includes(h)||Reflect.apply(c,i,u),Reflect.apply(c,d,u)}},set(d,h,c){return h==="_renderingLayerId"?(t=c,!0):(d[h]=c,Ut.includes(h)||(i[h]=c),!0)}})};function Ht(e){let t,n,i,s=`${e[0]}px`,o=`${e[1]}px`,d,h,c,u,y;const a=e[18].default,_=Et(a,e,e[17],null);return{c(){t=k("canvas"),d=V(),h=k("div"),_&&_.c(),S(t,"width",n=e[0]*e[5]),S(t,"height",i=e[1]*e[5]),S(t,"class",e[4]),S(t,"style",e[2]),D(t,"display","block"),D(t,"width",s),D(t,"height",o),D(h,"display","none")},m(g,w){F(g,t,w),e[64](t),F(g,d,w),F(g,h,w),_&&_.m(h,null),e[65](h),c=!0,u||(y=[l(t,"touchstart",Q(function(){v(e[3]?e[9]:null)&&(e[3]?e[9]:null).apply(this,arguments)})),l(t,"mousemove",function(){v(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),l(t,"pointermove",function(){v(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),l(t,"click",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"contextmenu",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"dblclick",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"mousedown",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"mouseenter",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"mouseleave",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"mouseup",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"wheel",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"touchcancel",Q(function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),l(t,"touchend",Q(function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),l(t,"touchmove",Q(function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),l(t,"pointerenter",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"pointerleave",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"pointerdown",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"pointerup",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"pointercancel",function(){v(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),l(t,"focus",e[19]),l(t,"blur",e[20]),l(t,"fullscreenchange",e[21]),l(t,"fullscreenerror",e[22]),l(t,"scroll",e[23]),l(t,"cut",e[24]),l(t,"copy",e[25]),l(t,"paste",e[26]),l(t,"keydown",e[27]),l(t,"keypress",e[28]),l(t,"keyup",e[29]),l(t,"auxclick",e[30]),l(t,"click",e[31]),l(t,"contextmenu",e[32]),l(t,"dblclick",e[33]),l(t,"mousedown",e[34]),l(t,"mouseenter",e[35]),l(t,"mouseleave",e[36]),l(t,"mousemove",e[37]),l(t,"mouseover",e[38]),l(t,"mouseout",e[39]),l(t,"mouseup",e[40]),l(t,"select",e[41]),l(t,"wheel",e[42]),l(t,"drag",e[43]),l(t,"dragend",e[44]),l(t,"dragenter",e[45]),l(t,"dragstart",e[46]),l(t,"dragleave",e[47]),l(t,"dragover",e[48]),l(t,"drop",e[49]),l(t,"touchcancel",e[50]),l(t,"touchend",e[51]),l(t,"touchmove",e[52]),l(t,"touchstart",e[53]),l(t,"pointerover",e[54]),l(t,"pointerenter",e[55]),l(t,"pointerdown",e[56]),l(t,"pointermove",e[57]),l(t,"pointerup",e[58]),l(t,"pointercancel",e[59]),l(t,"pointerout",e[60]),l(t,"pointerleave",e[61]),l(t,"gotpointercapture",e[62]),l(t,"lostpointercapture",e[63])],u=!0)},p(g,w){e=g,(!c||w[0]&33&&n!==(n=e[0]*e[5]))&&S(t,"width",n),(!c||w[0]&34&&i!==(i=e[1]*e[5]))&&S(t,"height",i),(!c||w[0]&16)&&S(t,"class",e[4]),(!c||w[0]&4)&&S(t,"style",e[2]),w[0]&1&&s!==(s=`${e[0]}px`)&&D(t,"width",s),w[0]&2&&o!==(o=`${e[1]}px`)&&D(t,"height",o),_&&_.p&&(!c||w[0]&131072)&&Rt(_,a,e,e[17],c?St(a,e[17],w,null):It(e[17]),null)},i(g){c||(ne(_,g),c=!0)},o(g){he(_,g),c=!1},d(g){g&&W(t),e[64](null),g&&W(d),g&&W(h),_&&_.d(g),e[65](null),u=!1,X(y)}}}const Se=Symbol(),Kt=()=>At(Se);function Gt(e,t,n){let i,{$$slots:s={},$$scope:o}=t,{width:d=640,height:h=640,pixelRatio:c=null,style:u="",autoclear:y=!0,layerEvents:a=!1}=t,{class:_=""}=t,g,w=null,E;const p=new zt;function z(){p.redraw()}function H(){return g}function K(){return w}c==null&&(typeof window<"u"?c=window.devicePixelRatio:c=2),Tt(Se,{register:p.register,unregister:p.unregister,redraw:p.redraw}),ce(()=>{const r=g.getContext("2d");a?(w=Yt(r),w._renderingLayerId=p.getRenderingLayerId):w=r,p.setup(w,E)}),de(()=>p.destroy());const B=r=>{const ie=r.offsetX*i,se=r.offsetY*i,oe=w._getLayerIdAtPixel(ie,se);p.setActiveLayer(oe,r),p.dispatchLayerEvent(r)},G=r=>{const{clientX:ie,clientY:se}=r.changedTouches[0],{left:oe,top:ft}=g.getBoundingClientRect(),pt=(ie-oe)*i,yt=(se-ft)*i,gt=w._getLayerIdAtPixel(pt,yt);p.setActiveLayer(gt,r),p.dispatchLayerEvent(r)},C=r=>{window.TouchEvent&&r instanceof TouchEvent&&r.preventDefault(),p.dispatchLayerEvent(r)};function J(r){f.call(this,e,r)}function m(r){f.call(this,e,r)}function b(r){f.call(this,e,r)}function R(r){f.call(this,e,r)}function P(r){f.call(this,e,r)}function O(r){f.call(this,e,r)}function T(r){f.call(this,e,r)}function re(r){f.call(this,e,r)}function Ce(r){f.call(this,e,r)}function Pe(r){f.call(this,e,r)}function Oe(r){f.call(this,e,r)}function Te(r){f.call(this,e,r)}function Ae(r){f.call(this,e,r)}function De(r){f.call(this,e,r)}function Me(r){f.call(this,e,r)}function qe(r){f.call(this,e,r)}function Ne(r){f.call(this,e,r)}function We(r){f.call(this,e,r)}function ze(r){f.call(this,e,r)}function Be(r){f.call(this,e,r)}function Fe(r){f.call(this,e,r)}function je(r){f.call(this,e,r)}function Ue(r){f.call(this,e,r)}function Xe(r){f.call(this,e,r)}function Ye(r){f.call(this,e,r)}function He(r){f.call(this,e,r)}function Ke(r){f.call(this,e,r)}function Ge(r){f.call(this,e,r)}function Je(r){f.call(this,e,r)}function Qe(r){f.call(this,e,r)}function Ze(r){f.call(this,e,r)}function Ve(r){f.call(this,e,r)}function xe(r){f.call(this,e,r)}function $e(r){f.call(this,e,r)}function et(r){f.call(this,e,r)}function tt(r){f.call(this,e,r)}function nt(r){f.call(this,e,r)}function rt(r){f.call(this,e,r)}function it(r){f.call(this,e,r)}function st(r){f.call(this,e,r)}function ot(r){f.call(this,e,r)}function lt(r){f.call(this,e,r)}function at(r){f.call(this,e,r)}function ut(r){f.call(this,e,r)}function ct(r){f.call(this,e,r)}function dt(r){ee[r?"unshift":"push"](()=>{g=r,n(6,g)})}function ht(r){ee[r?"unshift":"push"](()=>{E=r,n(7,E)})}return e.$$set=r=>{"width"in r&&n(0,d=r.width),"height"in r&&n(1,h=r.height),"pixelRatio"in r&&n(11,c=r.pixelRatio),"style"in r&&n(2,u=r.style),"autoclear"in r&&n(12,y=r.autoclear),"layerEvents"in r&&n(3,a=r.layerEvents),"class"in r&&n(4,_=r.class),"$$scope"in r&&n(17,o=r.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&2048&&n(5,i=c??1),e.$$.dirty[0]&1&&n(16,p.width=d,p),e.$$.dirty[0]&2&&n(16,p.height=h,p),e.$$.dirty[0]&32&&n(16,p.pixelRatio=i,p),e.$$.dirty[0]&4096&&n(16,p.autoclear=y,p),e.$$.dirty[0]&71683&&p.redraw()},[d,h,u,a,_,i,g,E,B,G,C,c,y,z,H,K,p,o,s,J,m,b,R,P,O,T,re,Ce,Pe,Oe,Te,Ae,De,Me,qe,Ne,We,ze,Be,Fe,je,Ue,Xe,Ye,He,Ke,Ge,Je,Qe,Ze,Ve,xe,$e,et,tt,nt,rt,it,st,ot,lt,at,ut,ct,dt,ht]}class Jt extends ge{constructor(t){super(),ye(this,t,Gt,Ht,te,{width:0,height:1,pixelRatio:11,style:2,autoclear:12,layerEvents:3,class:4,redraw:13,getCanvas:14,getContext:15},null,[-1,-1,-1])}get redraw(){return this.$$.ctx[13]}get getCanvas(){return this.$$.ctx[14]}get getContext(){return this.$$.ctx[15]}}function Qt(e){let t;return{c(){t=k("div"),S(t,"data-layer-id",e[0])},m(n,i){F(n,t,i)},p:I,i:I,o:I,d(n){n&&W(t)}}}function Zt(e,t,n){const{register:i,unregister:s,redraw:o}=Kt(),d=Ot();let{setup:h=void 0}=t,{render:c=()=>{}}=t;const u=i({setup:h,render:c,dispatcher:d});return de(()=>s(u)),e.$$set=y=>{"setup"in y&&n(1,h=y.setup),"render"in y&&n(2,c=y.render)},e.$$.update=()=>{e.$$.dirty&4&&o()},[u,h,c]}class Vt extends ge{constructor(t){super(),ye(this,t,Zt,Qt,te,{setup:1,render:2})}}const q=[];function xt(e,t){return{subscribe:Re(e,t).subscribe}}function Re(e,t=I){let n;const i=new Set;function s(h){if(te(e,h)&&(e=h,n)){const c=!q.length;for(const u of i)u[1](),q.push(u,e);if(c){for(let u=0;u<q.length;u+=2)q[u][0](q[u+1]);q.length=0}}}function o(h){s(h(e))}function d(h,c=I){const u=[h,c];return i.add(u),i.size===1&&(n=t(s)||I),h(e),()=>{i.delete(u),i.size===0&&(n(),n=null)}}return{set:s,update:o,subscribe:d}}let we;const Ie=Date.now(),ke=e=>(e(Date.now()-Ie),we=window.requestAnimationFrame(()=>ke(e)),()=>window.cancelAnimationFrame(we));function $t(){}xt(Date.now()-Ie,typeof window>"u"?$t:ke);function en(){const e=Re(null);let t,n=[];function i(){console.log("Connecting to WebSocket..."),t=new WebSocket("ws://localhost:5555/api/ws"),t.onerror=o=>{console.error("WebSocket error:",o),t.readyState===WebSocket.CLOSED&&(console.log("WebSocket connection closed. Reconnecting..."),setTimeout(i,1e3))},t.onopen=()=>{console.log("WebSocket connection established."),n.forEach(o=>{s(o)}),n=[]},t.onmessage=o=>{console.log("Received message:",o.data);const d=JSON.parse(o.data);e.set(d)},t.onclose=()=>{console.log("WebSocket connection closed. Reconnecting..."),setTimeout(i,1e3)},t.onerror=o=>{console.error("WebSocket error:",o)}}function s(o){t.readyState===WebSocket.OPEN?t.send(JSON.stringify(o)):t.readyState===WebSocket.CLOSED&&(n.length===0&&i(),n.push(o))}return ce(()=>{i(),fetch("/api/state").then(o=>o.json()).then(o=>{e.set(o)})}),de(()=>{t&&t.close()}),{worldState:e,sendCommand:s}}function tn(e){let t,n;return t=new Vt({props:{render:e[0]}}),{c(){Ee(t.$$.fragment)},m(i,s){fe(t,i,s),n=!0},p(i,s){const o={};s&1&&(o.render=i[0]),t.$set(o)},i(i){n||(ne(t.$$.fragment,i),n=!0)},o(i){he(t.$$.fragment,i),n=!1},d(i){pe(t,i)}}}function nn(e){let t,n,i,s,o,d,h,c,u;return d=new Jt({props:{width:840,height:600,class:"canvas",$$slots:{default:[tn]},$$scope:{ctx:e}}}),{c(){t=k("main"),n=k("div"),n.innerHTML='<canvas id="velocityChart" width="400" height="400"></canvas>',i=V(),s=k("div"),s.innerHTML='<canvas id="velocityChart" width="400" height="400"></canvas>',o=V(),Ee(d.$$.fragment),h=V(),c=k("div"),S(n,"class","sidebar svelte-pe4n82"),S(s,"class","sidebar svelte-pe4n82"),S(c,"class","sidebar svelte-pe4n82"),S(t,"class","cont svelte-pe4n82")},m(y,a){F(y,t,a),A(t,n),A(t,i),A(t,s),A(t,o),fe(d,t,null),A(t,h),A(t,c),u=!0},p(y,[a]){const _={};a&257&&(_.$$scope={dirty:a,ctx:y}),d.$set(_)},i(y){u||(ne(d.$$.fragment,y),u=!0)},o(y){he(d.$$.fragment,y),u=!1},d(y){y&&W(t),pe(d)}}}const Z=20;function rn(e,t,n){let i;const{sendCommand:d,worldState:h}=en();Lt(e,h,a=>n(4,i=a));let c=null;ce(()=>{let a=new Set;const _=E=>{a.add(E.key)},g=E=>{a.delete(E.key)};let w=setInterval(()=>{if(a.size===0)return;const E=i?.own_players.find(z=>z.id===c);if(!E)return;const p={id:E.id,sx:0,sy:0,w:0,dribble_speed:0,arm:!1,disarm:!1,kick:!1};a.has("w")&&(p.sx=1),a.has("s")&&(p.sx=-1),a.has("a")&&(p.sy=1),a.has("d")&&(p.sy=-1),a.has("q")&&(p.w=1),a.has("e")&&(p.w=-1),a.has(" ")&&(p.dribble_speed=200),(p.sx!==0||p.sy!==0||p.w!==0)&&d({type:"directPlayerCmd",cmd:p})},1/10);return window.addEventListener("keydown",_),window.addEventListener("keyup",g),()=>{clearInterval(w),window.removeEventListener("keydown",_),window.removeEventListener("keyup",g)}});let u=null,y;return e.$$.update=()=>{e.$$.dirty&28&&n(0,y=({context:a,width:_,height:g})=>{if(!i)return;const w=_-Z*2,E=g-Z*2,{own_players:p,opp_players:z,ball:H}=i,K=i.field_geom?.field_width??0,B=i.field_geom?.field_length??0,G=m=>Math.ceil(m*(w/B)),C=m=>{const[b,R]=m;return[(b+B/2)*(w/B)+Z,(-R+K/2)*(E/K)+Z]};a.fillStyle="#00aa00",a.clearRect(0,0,_,g),a.fillRect(0,0,_,g),i.field_geom?.line_segments?.forEach?.(({p1:m,p2:b})=>{const[R,P]=C(m),[O,T]=C(b);a.strokeStyle="white",a.beginPath(),a.moveTo(R,P),a.lineTo(O,T),a.stroke()});const J=(m,b,R)=>{const[P,O]=C(m),T=G(140);a.fillStyle=R,a.beginPath(),a.arc(P,O,T,0,2*Math.PI),a.fill(),console.log(b);const re=-b;a.save(),a.translate(P,O),a.rotate(re),a.beginPath(),a.moveTo(0,0),a.lineTo(T,0),a.closePath(),a.restore(),a.stroke()};if(p.forEach(({raw_position:m,orientation:b})=>J(m,b,"blue")),z.forEach(({raw_position:m,orientation:b})=>J(m,b,"yellow")),H){const m=C(H.position),b=G(43);a.fillStyle="red",a.beginPath(),a.arc(m[0],m[1],b,0,2*Math.PI),a.fill()}if(i?.own_players.length>0){let m=i.own_players[0];if(c===null)n(2,c=i.own_players[0].id);else{const b=i.own_players.find(R=>R.id===c);b?m=b:n(2,c=m.id)}Math.sqrt(m.velocity[0]**2+m.velocity[1]**2),u===null&&n(3,u=m.timestamp),m.timestamp-u}if(i?.own_players.length>0){let m=i.own_players[0];if(c===null)n(2,c=i.own_players[0].id);else{const b=i.own_players.find(R=>R.id===c);b?m=b:n(2,c=m.id)}Math.sqrt(m.velocity[0]**2+m.velocity[1]**2),u===null&&n(3,u=m.timestamp),m.timestamp-u}})},[y,h,c,u,i]}class sn extends ge{constructor(t){super(),ye(this,t,rn,nn,te,{})}}new sn({target:document.getElementById("app")});
